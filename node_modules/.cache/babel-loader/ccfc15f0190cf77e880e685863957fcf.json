{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.PolicyConstraints = void 0;\n\nvar json_1 = require(\"../../util/json\");\n\nvar Coin_1 = require(\"../Coin\");\n\nvar numeric_1 = require(\"../numeric\");\n\nvar treasury_1 = require(\"@terra-money/terra.proto/terra/treasury/v1beta1/treasury\");\n/**\n * This captures the Treasury module's `tax_policy` and `reward_policy` parameters, which\n * determine how the Tax Rate and Reward Weight values are allowed to change.\n */\n\n\nvar PolicyConstraints =\n/** @class */\nfunction (_super) {\n  __extends(PolicyConstraints, _super);\n  /**\n   *\n   * @param rate_min minimum value\n   * @param rate_max maximum value\n   * @param cap Tax Cap (only applicable for Tax Rate)\n   * @param change_rate_max max change %\n   */\n\n\n  function PolicyConstraints(rate_min, rate_max, cap, change_rate_max) {\n    var _this = _super.call(this) || this;\n\n    _this.cap = cap;\n    _this.rate_min = new numeric_1.Dec(rate_min);\n    _this.rate_max = new numeric_1.Dec(rate_max);\n    _this.change_rate_max = new numeric_1.Dec(change_rate_max);\n    return _this;\n  }\n\n  PolicyConstraints.fromAmino = function (data) {\n    var rate_min = data.rate_min,\n        rate_max = data.rate_max,\n        cap = data.cap,\n        change_rate_max = data.change_rate_max;\n    return new PolicyConstraints(rate_min, rate_max, Coin_1.Coin.fromAmino(cap), change_rate_max);\n  };\n\n  PolicyConstraints.prototype.toAmino = function () {\n    var _a = this,\n        rate_min = _a.rate_min,\n        rate_max = _a.rate_max,\n        cap = _a.cap,\n        change_rate_max = _a.change_rate_max;\n\n    return {\n      rate_min: rate_min.toString(),\n      rate_max: rate_max.toString(),\n      cap: cap.toAmino(),\n      change_rate_max: change_rate_max.toString()\n    };\n  };\n\n  PolicyConstraints.fromData = function (data) {\n    var rate_min = data.rate_min,\n        rate_max = data.rate_max,\n        cap = data.cap,\n        change_rate_max = data.change_rate_max;\n    return new PolicyConstraints(rate_min, rate_max, Coin_1.Coin.fromData(cap), change_rate_max);\n  };\n\n  PolicyConstraints.prototype.toData = function () {\n    var _a = this,\n        rate_min = _a.rate_min,\n        rate_max = _a.rate_max,\n        cap = _a.cap,\n        change_rate_max = _a.change_rate_max;\n\n    return {\n      rate_min: rate_min.toString(),\n      rate_max: rate_max.toString(),\n      cap: cap.toData(),\n      change_rate_max: change_rate_max.toString()\n    };\n  };\n\n  PolicyConstraints.fromProto = function (proto) {\n    return new PolicyConstraints(proto.rateMax, proto.rateMin, Coin_1.Coin.fromProto(proto.cap), proto.changeRateMax);\n  };\n\n  PolicyConstraints.prototype.toProto = function () {\n    var _a = this,\n        rate_min = _a.rate_min,\n        rate_max = _a.rate_max,\n        cap = _a.cap,\n        change_rate_max = _a.change_rate_max;\n\n    return treasury_1.PolicyConstraints.fromPartial({\n      cap: cap.toProto(),\n      changeRateMax: change_rate_max.toString(),\n      rateMax: rate_max.toString(),\n      rateMin: rate_min.toString()\n    });\n  };\n  /**\n   * You can simulate the result of the clamping algorithm, which subjects updates in\n   * rate to the rules defined by the `PolicyConstraints`.\n   *\n   * @param prevRate previous rate\n   * @param newRate next rate\n   * @returns New rate, after clamping constraints have been applied\n   */\n\n\n  PolicyConstraints.prototype.clamp = function (prevRate, newRate) {\n    var p = new numeric_1.Dec(prevRate); // prev\n\n    var n = new numeric_1.Dec(newRate); // new\n\n    if (n.lt(this.rate_min)) {\n      n = this.rate_min;\n    } else if (n.gt(this.rate_max)) {\n      n = this.rate_max;\n    }\n\n    var delta = n.sub(p);\n\n    if (n.gt(p)) {\n      if (delta.gt(this.change_rate_max)) {\n        n = p.add(this.change_rate_max);\n      }\n    } else {\n      if (delta.abs().gt(this.change_rate_max)) {\n        n = p.sub(this.change_rate_max);\n      }\n    }\n\n    return n;\n  };\n\n  return PolicyConstraints;\n}(json_1.JSONSerializable);\n\nexports.PolicyConstraints = PolicyConstraints;","map":{"version":3,"sources":["../../../src/core/treasury/PolicyConstraints.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.PolicyConstraints = void 0;\nvar json_1 = require(\"../../util/json\");\nvar Coin_1 = require(\"../Coin\");\nvar numeric_1 = require(\"../numeric\");\nvar treasury_1 = require(\"@terra-money/terra.proto/terra/treasury/v1beta1/treasury\");\n/**\n * This captures the Treasury module's `tax_policy` and `reward_policy` parameters, which\n * determine how the Tax Rate and Reward Weight values are allowed to change.\n */\nvar PolicyConstraints = /** @class */ (function (_super) {\n    __extends(PolicyConstraints, _super);\n    /**\n     *\n     * @param rate_min minimum value\n     * @param rate_max maximum value\n     * @param cap Tax Cap (only applicable for Tax Rate)\n     * @param change_rate_max max change %\n     */\n    function PolicyConstraints(rate_min, rate_max, cap, change_rate_max) {\n        var _this = _super.call(this) || this;\n        _this.cap = cap;\n        _this.rate_min = new numeric_1.Dec(rate_min);\n        _this.rate_max = new numeric_1.Dec(rate_max);\n        _this.change_rate_max = new numeric_1.Dec(change_rate_max);\n        return _this;\n    }\n    PolicyConstraints.fromAmino = function (data) {\n        var rate_min = data.rate_min, rate_max = data.rate_max, cap = data.cap, change_rate_max = data.change_rate_max;\n        return new PolicyConstraints(rate_min, rate_max, Coin_1.Coin.fromAmino(cap), change_rate_max);\n    };\n    PolicyConstraints.prototype.toAmino = function () {\n        var _a = this, rate_min = _a.rate_min, rate_max = _a.rate_max, cap = _a.cap, change_rate_max = _a.change_rate_max;\n        return {\n            rate_min: rate_min.toString(),\n            rate_max: rate_max.toString(),\n            cap: cap.toAmino(),\n            change_rate_max: change_rate_max.toString(),\n        };\n    };\n    PolicyConstraints.fromData = function (data) {\n        var rate_min = data.rate_min, rate_max = data.rate_max, cap = data.cap, change_rate_max = data.change_rate_max;\n        return new PolicyConstraints(rate_min, rate_max, Coin_1.Coin.fromData(cap), change_rate_max);\n    };\n    PolicyConstraints.prototype.toData = function () {\n        var _a = this, rate_min = _a.rate_min, rate_max = _a.rate_max, cap = _a.cap, change_rate_max = _a.change_rate_max;\n        return {\n            rate_min: rate_min.toString(),\n            rate_max: rate_max.toString(),\n            cap: cap.toData(),\n            change_rate_max: change_rate_max.toString(),\n        };\n    };\n    PolicyConstraints.fromProto = function (proto) {\n        return new PolicyConstraints(proto.rateMax, proto.rateMin, Coin_1.Coin.fromProto(proto.cap), proto.changeRateMax);\n    };\n    PolicyConstraints.prototype.toProto = function () {\n        var _a = this, rate_min = _a.rate_min, rate_max = _a.rate_max, cap = _a.cap, change_rate_max = _a.change_rate_max;\n        return treasury_1.PolicyConstraints.fromPartial({\n            cap: cap.toProto(),\n            changeRateMax: change_rate_max.toString(),\n            rateMax: rate_max.toString(),\n            rateMin: rate_min.toString(),\n        });\n    };\n    /**\n     * You can simulate the result of the clamping algorithm, which subjects updates in\n     * rate to the rules defined by the `PolicyConstraints`.\n     *\n     * @param prevRate previous rate\n     * @param newRate next rate\n     * @returns New rate, after clamping constraints have been applied\n     */\n    PolicyConstraints.prototype.clamp = function (prevRate, newRate) {\n        var p = new numeric_1.Dec(prevRate); // prev\n        var n = new numeric_1.Dec(newRate); // new\n        if (n.lt(this.rate_min)) {\n            n = this.rate_min;\n        }\n        else if (n.gt(this.rate_max)) {\n            n = this.rate_max;\n        }\n        var delta = n.sub(p);\n        if (n.gt(p)) {\n            if (delta.gt(this.change_rate_max)) {\n                n = p.add(this.change_rate_max);\n            }\n        }\n        else {\n            if (delta.abs().gt(this.change_rate_max)) {\n                n = p.sub(this.change_rate_max);\n            }\n        }\n        return n;\n    };\n    return PolicyConstraints;\n}(json_1.JSONSerializable));\nexports.PolicyConstraints = PolicyConstraints;\n//# sourceMappingURL=PolicyConstraints.js.map"]},"metadata":{},"sourceType":"script"}